#check if age is EM
# calling data
# setwd("/Users/sulailfatima/Desktop/Megasync/transgenderdata")
tg.data <- read.spss("Data_transgenderBSSImodification_dataUpdated.sav",
                     to.data.frame = T,
                     use.value.labels = TRUE,
                     trim.factor.names = F,
                     trim_values = F)
sum(is.na(tg.data$SocCap36a))
mean_age <- mean(tg.data$SocCap36a, na.rm = TRUE)
tg.data$SocCap36a <- ifelse(is.na(tg.data$SocCap36a), mean_age, tg.data$SocCap36a)

#scaling
### BSSI
ave.bssi <- mean(tg.data$BSSIScore2)
sd.bssi <- sd(tg.data$BSSIScore2)
tg.data$stdbssi <- ((tg.data$BSSIScore2 - ave.bssi)/sd.bssi)
## SC
ave.sc <- mean(tg.data$SCTotalScore)
sd.sc <- sd(tg.data$SCTotalScore)
tg.data$stdsc <- ((tg.data$SCTotalScore - ave.sc)/sd.sc)
## age
ave.age <- mean(tg.data$SocCap36a)
sd.age <- sd(tg.data$SocCap36a)
tg.data$std.age <- ((tg.data$SocCap36a - ave.age)/sd.age)
## AKUADS SCORE
ave.akuads <- mean(tg.data$AKUADSScore2)
sd.akuads <- sd(tg.data$AKUADSScore2)
tg.data$stdakuads <- ((tg.data$AKUADSScore2 - ave.akuads)/sd.akuads)
library(stdmod)
tg.model1 <- lm(BSSIScore2 ~ SCTotalScore  + AKUADSScore2 + SCTotalScore*AKUADSScore2 + 
                  SocCap36a + SocCap35a + SocCap44a_Rec +SocCap45a_Rec + 
                  SocCap41a_Rec + SocCap42a, data = tg.data)
plotmod(tg.model1,
        x = "SCTotalScore",
        w = "AKUADSScore2",
        w_method = c("sd","percentile"),
        w_percentiles = c(0.25, 0.75),
        xlim = c(0,80))

plot## adding age as a moderator
# causal steps
mod1 <- lm(BSSIScore2 ~ SCTotalScore + SocCap36a + SocCap35a + SocCap44a_Rec +
             SocCap45a_Rec + SocCap42a, data = tg.data)
mod2 <- lm(AKUADSScore2 ~ SCTotalScore + SocCap36a + SocCap35a + SocCap44a_Rec +
             SocCap45a_Rec + SocCap41a_Rec + SocCap42a, 
           data = tg.data) # mediator model
mod3 <- lm(BSSIScore2 ~ SCTotalScore  + AKUADSScore2 + SCTotalScore*AKUADSScore2 + 
             SocCap36a + SocCap35a + SocCap44a_Rec +SocCap45a_Rec + 
             SocCap41a_Rec + SocCap42a, data = tg.data) # outcome model
mod4 <- lm(BSSIScore2 ~ SCTotalScore*AKUADSScore2 + SocCap36a + 
             SocCap35a + SocCap44a_Rec + SocCap45a_Rec + SocCap41a_Rec +
             SocCap42a, data = tg.data)

medmodel.tg <- mediate(model.m = mod2, model.y = mod3,
                       sims = 100,
                       boot = T,
                       boot.ci.type = "bca",
                       treat = "SCTotalScore",
                       mediator = "AKUADSScore2")
summary(medmodel.tg)
plot(medmodel.tg, xlim = c(-1.2, 0.1))


tg.testint <- test.TMint(medmodel.tg, conf.level = .95)
tg.testint

# sensitivity analysis

tg.sensi <- medsens(medmodel.tg, rho.by = 0.1, 
                    eps = sqrt(.Machine$double.eps),  
                    effect.type = "both")
summary(tg.sensi)
plot(tg.sensi)
